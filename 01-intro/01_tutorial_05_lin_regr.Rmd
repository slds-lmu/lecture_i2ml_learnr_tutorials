## Linear Regression

```{r, include=FALSE}
polynomialTrafo = function (data, feature, degree) {
  feature_idx = which(feature == names(data))
  df_poly = as.data.frame(poly(data[[feature]], degree))
  names(df_poly) = paste0(feature, ".poly", seq_len(degree))
  return(cbind(data[, -feature_idx, drop = FALSE], df_poly))
}
```

### Study Goals

*Theoretical (T)*

- Learn how linear regression model works

*Practical (P)*

- Get to know how to fit a linear regression model in `mlr`

### Preparation

1.  *(T)* Watch the following video  (sorry, rather low volume...):
    <center>
    ![](https://www.youtube.com/watch?v=v9eocCAfJ_w&list=PLMyWaJl2LoXyhFvMjtbBGs0Pi8khHbKm3&index=6&t=0s){width="75%"}
    </center>

1.  *(P)* Make sure that you have understand how to define tasks and learner as well as how to train a learner.

### Exercises

#### *(T)* Quiz

```{r lm-quiz, echo=FALSE}
question("What statements are true?",
  answer("The target in linear regression has to be numeric", correct = TRUE),
  answer("The features in the linear model can also just be numerical"),
  answer("The linear model is linear regression with L2-loss", correct = TRUE),
  answer("It's just possible to model linear effects of a feature"),
  answer("Overfitting is a present danger in polynomial regression", correct = TRUE)
)
```

#### *(P)* Create a regression task

Create a regression task using the `mtcars` dataset with target variable `mpg` and polynomial feature `hp` of degree 3 (use the helper function below to generate a dataset for polynomial regression):

```{r mtcars-task, exercise=TRUE, exercise.lines=5, exercise.checker=createChecker(c("task_data", "mtcars_task"))}
task_data =
mtcars_task =
```

```{r mtcars-task-hint-1}
# Use 'polynomialTrafo' to get the desired data.frame
task_data = polynomialTrafo(data = mtcars[, c("mpg", "hp")], feature = "hp", degree = 3)
```

```{r mtcars-task-hint-2}
# Use the 'task_data' in 'makeRegrTask'
makeRegrTask(data = task_data, ...)
```

```{r mtcars-task-solution}
task_data = polynomialTrafo(data = mtcars[, c("mpg", "hp")], feature = "hp", degree = 3)
makeRegrTask(data = task_data, target = "mpg")
```

```{r mtcars-task-check}
task_data = polynomialTrafo(data = mtcars[, c("mpg", "hp")], feature = "hp", degree = 3)
mtcars_task = makeRegrTask(data = task_data, target = "mpg")
```

```{r poly-trafo, exercise=TRUE}
# helper function to extract polynomial features:
polynomialTrafo = function (data, feature, degree) {
  feature_idx = which(feature == names(data))
  # function 'poly' creates numerically well-behaved polynomials: orthogonal, etc.
  df_poly = as.data.frame(poly(data[[feature]], degree))
  names(df_poly) = paste0(feature, ".poly", seq_len(degree))
  return(cbind(data[, -feature_idx, drop = FALSE], df_poly))
}
# Example: Create polynomial feature map with degree 2 of wt
data_trafo = polynomialTrafo(mtcars[, c("mpg", "wt")], "wt", 2)
head(data_trafo)
```

#### *(P)* Define the linear model

Now, as for k-NN, define a learner. Use a regression learner of the `lm` function.

```{r lm-learner, exercise=TRUE, exercise.lines=5, exercise.checker=createChecker("lm_learner")}
lm_learner =
```

```{r lm-learner-hint-1}
# To see all available learners you can simply call
listLearners()
```

```{r lm-learner-hint-2}
# You can pass the task to get suitable learner
listLearners(mtcars_task)
```

```{r lm-learner-check}
lm_learner = makeLearner("regr.lm")
```

#### *(P)* Train the linear model

```{r, include=FALSE}
task_data = polynomialTrafo(data = mtcars[, c("mpg", "hp")], feature = "hp", degree = 3)
mtcars_task = makeRegrTask(data = task_data, target = "mpg")
lm_learner = makeLearner("regr.lm")

```


```{r lm-train, exercise=TRUE, exericse.lines=5, exercise.checker=createChecker("lm_model")}
lm_model =
```

```{r lm-train-check}
lm_model = train(lm_learner, mtcars_task)
```

#### *(P)* Visualize the polynomial regression

To draw the curve you can use the code below, try different number of degrees. How does the curve change? What can you observe?

```{r lm-poly-viz, exercise=TRUE}
library(ggplot2)

# Change degree here
degree = 3

# You can leave this code as it is, just use the objects from above and 
# degree as variable in the task data generation:
task_data = 
mtcars_task = 
lm_learner = 
lm_model = 

hp_pred = seq(min(mtcars$hp), max(mtcars$hp), length.out = 100)
pred_data = polynomialTrafo(data.frame(hp = hp_pred), "hp", degree)

plot_data = data.frame(mpg_pred = predict(lm_model, newdata = pred_data)$data$response, hp = hp_pred)
ggplot() + geom_point(data = mtcars, aes(x = hp, y = mpg)) + geom_line(data = plot_data, aes(x = hp, y = mpg_pred))
```
